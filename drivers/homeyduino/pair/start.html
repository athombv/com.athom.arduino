<style type="text/css">
	.instructions {
		display: flex;
		flex-direction: column;
		justify-content: center;
		text-align: center;
	}
	.instructions img {
		max-width: 100%;
		height: auto;
	}
	.instructions p {

	}
	
	label{
		display:inline-block;
		width:200px;
		margin-right:30px;
		text-align:right;
	}

	input{
		padding-top: 2px;
		padding-bottom: 2px;
		height: 32px;
		font-size: 25px;
	}

	fieldset{
		border:none;
		width:500px;
		margin:0px auto;
	}
	
	.row {
		height: 36px;
		padding: auto;
		line-height: 32px;
	}
	
	.right {
		right: 5px;
	}

</style>

<div class="instructions">
	<p class="instruction" data-i18n="pair.instruction"></p>
</div>

<hr />

<form name="deviceForm">
	<fieldset>
		<div class="row"><label for="name" data-i18n="pair.name"></label><input type="text" name="name" size=8 /></div><br />
		<div class="row"><label for="p"><img src="icon_p.svg" /></label><input type="text" name="p" size=8 onChange="fixNumber(p)" /></div><br />
		<div class="row"><label for="i"><img src="icon_i.svg" /></label><input type="text" name="i" size=8 onChange="fixNumber(i)" /></div><br />
		<div class="row"><label for="d"><img src="icon_d.svg" /></label><input type="text" name="d" size=8 onChange="fixNumber(d)" /></div>
	</fieldset>
	<hr />
	<button type="button" class="button right" onclick="addDevice(deviceForm)" data-i18n="pair.button.add"></button>
</form>

<script>
	Homey.setTitle(__('pair.title'));
	console.log("Page loaded");
	
	function fixNumber(i) {
		if (isNaN(i.value)) {
			i.value=0;
		} else {
			i.value = Number(i.value);
		}
	}
	
	function guid() {
 		function s4() {
 			return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);
 		}
 		return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();
 	}
	function addDevice( details ) {
		console.log("addDevice called");
		Homey.addDevice({
			data: {
				id: guid(),
				version: 1
			},
			name: details["name"].value,
			settings: { 'p': Number(details["p"].value), 'i': Number(details["i"].value), 'd': Number(details["d"].value) }
		}, function( err, result ){
			if( err ) return console.error(err);
			console.log("Success!");
			Homey.done();
		});
	}
</script>
